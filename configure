#!/bin/bash

showhelp()
{
cat << ENDHELP

usage: configure [options]
Configure p2p

Options:
    --help
    Display this help screen
ENDHELP
}

upx_bin=upx
upx_go=$GOPATH/bin/goupx

echo "checking go environment"
if [ "$GOPATH" == "" ]; then
    echo "GOPATH is not set. Aborting"
    exit 1
fi

echo "checking upx"
hash upx 2>/dev/null || { echo >&2 "upx is not installed" ; upx_bin="" ; }

echo "checking goupx"
if [ ! -x $upx_go ]; then
    echo "upxgo was not found"
    upx_go=""
fi

# generating config.make file
echo "# config.make generated by configure script" > config.make
if [ "$upx_go" != "" ]; then
    echo "UPX_GO = $upx_go" >> config.make
    echo "export UPX_GO" >> config.make
    if [ "$upx_bin" != "" ]; then
        echo "UPX_BIN = $upx_bin" >> config.make
        echo "export UPX_BIN" >> config.make
    fi
fi
